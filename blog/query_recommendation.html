<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Building a query recommendation system - Chan's Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="./favicon.ico" rel="icon">

<link rel="canonical" href="./query_recommendation.html">

        <meta name="author" content="Chan Y. Park" />
        <meta name="keywords" content="experience" />
        <meta name="description" content="Alternative civilian service From October 2003 to December 2005, I had worked at a couple of tech companies for an alternative civilian service. Except that working in the companies were counted as fulfilling mandatory military service that every Korean man is required to serve, everything is just the same as …" />

        <meta property="og:site_name" content="Chan's Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Building a query recommendation system"/>
        <meta property="og:url" content="./query_recommendation.html"/>
        <meta property="og:description" content="Alternative civilian service From October 2003 to December 2005, I had worked at a couple of tech companies for an alternative civilian service. Except that working in the companies were counted as fulfilling mandatory military service that every Korean man is required to serve, everything is just the same as …"/>
        <meta property="article:published_time" content="2017-01-10" />
            <meta property="article:section" content="articles" />
            <meta property="article:tag" content="experience" />
            <meta property="article:author" content="Chan Y. Park" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./static/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Chan's Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="./category/articles.html">Articles</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./query_recommendation.html"
                       rel="bookmark"
                       title="Permalink to Building a query recommendation system">
                        Building a query recommendation system
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-01-10T10:56:34.359128-05:00"> Tue 10 January 2017</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="./tag/experience.html">experience</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <div class="section" id="alternative-civilian-service">
<h2>Alternative civilian service</h2>
<p>From October 2003 to December 2005, I had worked at a couple of tech companies for an alternative civilian service. Except that working in the companies were counted as fulfilling mandatory military service that every Korean man is required to serve, everything is just the same as working at a usual company: one needs to find a company that has a quota for such an alternative service, apply for the position, and start one's work when he gets an offer.</p>
<p>On the one hand, landing on such a workplace may be difficult because there was a limited number of such positions. But on the other hand it may be easier than getting a &quot;real&quot; job, because usually those positions are underpaid and once you start at one place it is not easy to move to another place because of many regulations and policies, so companies are more than willing to fill the spots. I have little idea the net difficulty is plus or minus on average, but in my case I think I was just lucky in both finding such positions and having wonderful colleagues there.</p>
</div>
<div class="section" id="learning-how-to-code">
<h2>Learning how to code</h2>
<p>The first company that I worked for a year was <em>Softwise</em> in Seoul, Korea. The company's key product was developing and deploying intra- and internet search engines. When I started working there, it was the provider of web search engine for Yahoo! Korea, and back then Yahoo! was one of big players in web search engine business, so there were plenty of good people and resources. I was thrilled to work at the company because I read all exciting things about the internet and search engines; it was the beginning of the new millenia and the time was like that.</p>
<p>I was the youngest in the company and also knew next to nothing about programming, letting alone web search engines. Fortunately my seniors there were usually computer science majors and/or had plenty of programming experiences and many of them were very kind toward a novice like me. (Of course there always are a couple of mean guys, but that's life, I suppose.) So during the one year I was able to learn a lot about coding programs and designing products.</p>
</div>
<div class="section" id="wiki-and-python">
<h2>Wiki and Python</h2>
<p>There I first saw a wiki being used as a collaborative idea pool and scratch pad for a team. At that time we were using <a class="reference external" href="https://moinmo.in/">MoinMoin</a>, which is written in Python. I think the Python version at that time was 1.x. I was fascinated by wiki since then and I keep maintaining a personal wiki for various purposes. However I was not impressed with Python at that time, thought it was a niche language and did not pay much attention to it until a few years ago. It would have been much more fun if I was able to foresee the bright future of Python at that time and participated in the development of Python community! Well, I knew really nothing then and also there were no wonderful libraries like NumPy and SciPy at that time, those are my excuses. Because of that, and probably because the Python implementation itself was not as fast as it is these days, plus slower computing power and fewer resources meant that Python was not ready for its prime time back then and the major products in the company were written in C/C++. Python was considered to be a script language and at that time Perl was the king of script languages; seems that Perl has disappeared into nowhere these days except deep in the code for bioinformatics, which is not surprising considering its notriously bad readability and the culture of Perl community making a competition of writing a code as short as possible at the sacrifice of everything else.</p>
<a class="reference external image-reference" href="http://perl-begin.org/humour/perl6_perl_6_cover_lg.jpg"><img alt="perl humor" class="align-center" src="./figures/p6_cover.png" /></a>
</div>
<div class="section" id="web-and-database-programming">
<h2>Web and database programming</h2>
<p>The second project was building an administration system for the database search system of Yahoo! Korea. During this project I learned PHP and MySQL, another eye-opening experience of web script and database, thanks to which I understand SQL jokes like the following xkcd comic:</p>
<img alt="xkcd comic about SQL" class="align-center" src="http://imgs.xkcd.com/comics/exploits_of_a_mom.png" />
<p>It was a fun project because I had been learning new things and because it was a short one, but in retrospect there was not much intrinsically interesting about it.</p>
</div>
<div class="section" id="armwrestling-with-windows-server">
<h2>Armwrestling with Windows Server</h2>
<p>And then came the third project, building a query recommendation system, which is the main topic of this post. Ironically at that time I didn't give much about this project compared to others, but in retrospect I think this was the best project during the year at the company. First of all, this was my first project of building a prototype based on a new algorithm appeared on a computer science paper, which then developed into a full commerical service deployed to <a class="reference external" href="https://en.wikipedia.org/wiki/Nate_(web_portal)">Nate</a>, one of the top 3 web portals of South Korea at that time with the most local page views of 3.8 million among the three. Secondly, this was also a first time that I was challenged with designing multiprocessing/multithreading program, this time using Visual C++ and MS-SQL as Nate was operating on Windows Server system: multiprocessing was needed to process query logs in parallel, multithreading was required for the admin GUI.</p>
<p>Experience of using Windows Server was kind of comical; there is nothing wrong with Visual C++ or MS-SQL, rather I loved and still like the polished aspect of those commercial softwares in comparison to open source softwares like gcc or MySQL, like a suit vs. a jean. The only thing I hated was, somehow Windows Server at that time (probably it was Windows Server 2000) lacked any good command-line interface, so I had to connect to a server via Windows remote desktop and do most of the work using a mouse. Again, nothing wrong with using a mouse and I think Windows is a good OS for a desktop, the problem was this was a server far away from my desk and the internet speed was not fantastic like it is nowadays, therefore there was a bit of delay between moving my mouse and the mouse cursor actually moving as the signal did an expensive round-trip from my client to the server back to my client with all the pixel data carried along. And human brain, or rather my brain, recognized this in a funny way such that I pushed and pulled my mouse <strong>harder</strong> as if the mouse cursor was moving in that way because it is heavy and I was not exerting enough force to move it around. The result was that I got easily exhausted with the hard work of double clicking a few icons to start and stop the service.</p>
</div>
<div class="section" id="query-recommendation-using-query-logs">
<h2>Query recommendation using query logs</h2>
<p>Finally let me describe how we built the recommendation system. Unfortunately I cannot recall everything in full detail, because it was more than a decade ago and I didn't leave any document of that experience. I will instead describe what I probably did that fits all the fragments of my memory and introduce a couple of papers <a class="footnote-reference" href="#fonseca" id="id1">[1]</a> <a class="footnote-reference" href="#baeza-yates" id="id2">[2]</a> related to query recommendation that somehow I was able to recall the names of the authors from a remote corner of my brain.</p>
<p>The idea of <a class="footnote-reference" href="#fonseca" id="id3">[1]</a> is simple but works good when there is a large dataset available. First imagine what we do when we use Google. We first type in a sequence of words, which is a query, into a search box and see the result. If we are lucky we will find what we want in the result page, click the URL and off we go. But if we are not satisfied with the result, which may be due to a typo or due to not picking the right query, we come up with a different query, submit it, and check the result. This will go on until we find a satisfactory result, and the series of queries is a session, whose end is marked with the user clicking one of the URLs in the result. Then we say the queries appearing in a session are related, and the goal is that when a user inputs a query, we want to provide the user recommened queries sorted by rank.</p>
<p>Defining a user session was a point of dispute back in the day, and in <a class="footnote-reference" href="#fonseca" id="id4">[1]</a> it is done by splitting queries from the same IP address by a fixed time interval. But I think we can do better these days thanks to the advancement of web browser and web server technologies and actually define a true user session. Then the question becomes how to rank the related queries, e.g. how to give a ranking for a relation of two queries. The suggestion of <a class="footnote-reference" href="#fonseca" id="id5">[1]</a> is straightforward: we rank a pair of queries (X, Y) by the percentage of sessions in all the sessions containing both query X and query Y. This is simple enough to apply to large log data, and this is the key: we need a <strong>large</strong> dataset of queries, otherwise the estimation will be too noisy.</p>
<p>Indeed this algorithm was simple enough to analyze all the query logs and update the ranking within one day back then, and still was powerful enough to provide query recommendation service for the web portal without further modification because it was a major web portal with so many visitors furnishing queries to the search engine.</p>
<p>But if you google 'query recommendation' then the first paper that comes up is <a class="footnote-reference" href="#baeza-yates" id="id6">[2]</a>, and I somehow have thought that the algorithm we applied for the service was from the paper before reading both papers, so let me say a few things I gathered from the other paper. One weakness of <a class="footnote-reference" href="#fonseca" id="id7">[1]</a> pointed out by <a class="footnote-reference" href="#baeza-yates" id="id8">[2]</a> is that two queries are related only if they appear in the same user session. So if there are two queries each of which is submitted in a separate session, they will have no relation. So <a class="footnote-reference" href="#baeza-yates" id="id9">[2]</a> suggests that instead we should group queries into clusters by 'similarity' defined the paper. Then when an input query X is given by a user, we identify the cluster it belongs to, calculate a rank of each query Y inside the cluster, and recommend queries ordered by the ranks. The rank is calculated by combining the similarity between X (the input query) and Y (the query to recommend) and the 'support' of Y, which indicates how many users find Y helpful and is calculated from the clicked results, assuming that a helpful query results in many clicks by users among the search results brought by the query.</p>
<p>The whole business of query recommendation, in retrospect, has a strong flavor of data science: requirement of large data to quench noise in signal, k-means clustering, classification by user feedback, and so on. It seems that there are some public query datasets available, so I would like to implement both algorithms and see how one fares against the other. Although query clustering sounds fancy and intersting, it seems that once there is a large number of queries probably the straightforward algorithm of using query sessions will perform as good as or even better than the query clustering algorithm.</p>
</div>
<div class="section" id="epilogue">
<h2>Epilogue</h2>
<p>Unfortunately around the time of my third project, when I felt I was finally ready to work on the interesting project of web search engine development, Yahoo! Korea declared that they will end the contract with Softwise because Yahoo! HQ's global policy has changed to using a single search engine for all the international Yahoo! portals. And in any case Google was becoming a dominant player in the web search business, so Softwise aborted web search engine development and focused on getting contract projects of developing intranet search engines for public departments and private companies. Disappointed with that, I moved to another company that makes atomic force microscope (AFM) and had a project of working with an OS (NetBSD) kernel for me, which I will describe in another post.</p>
</div>
<div class="section" id="references">
<h2>References</h2>
<table class="docutils footnote" frame="void" id="fonseca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id3">2</a>, <a class="fn-backref" href="#id4">3</a>, <a class="fn-backref" href="#id5">4</a>, <a class="fn-backref" href="#id7">5</a>)</em> <a class="reference external" href="http://dl.acm.org/citation.cfm?id=952387">B. M. Fonseca, P. B Golgher, E. S. De Moura, and N. Ziviani, Using association rules to discovery search engines related queries.</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="baeza-yates" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id6">2</a>, <a class="fn-backref" href="#id8">3</a>, <a class="fn-backref" href="#id9">4</a>)</em> <a class="reference external" href="http://dl.acm.org/citation.cfm?id=2146527">R. Baeza-Yates, C. Hurtado, and M. Mendoza, Query Recommendation Using Query Logs in Search Engines</a></td></tr>
</tbody>
</table>
</div>

            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'chan-y-park'; // required: replace example with your forum shortname

                    var disqus_identifier = 'query_recommendation';
                var disqus_url = './query_recommendation.html';

            var disqus_config = function () {
                this.page.url = disqus_url;
                this.page.identifier = disqus_identifier;
                this.language = "en";
            };

            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Follow</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="http://github.com/chan-y-park"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="http://www.linkedin.com/in/chan-youn-park-51a13b63"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
                <li class="list-group-item"><a href="http://twitter.com/chan_y_park"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                <li class="list-group-item"><a href="http://www.facebook.com/chan.y.park.5"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://chan.physics.rutgers.edu/loom" target="_blank">
                loom
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://chan.physics.rutgers.edu/cproj" target="_blank">
                cproj
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Chan Y. Park
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
    /*
        var disqus_shortname = 'chan-y-park'; // required: replace example with your forum shortname

        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    */
    </script>
    <!-- End Disqus Code -->

        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=github blog"></script>
</body>
</html>